{% extends "base.html" %}

{% block title %}Performance - Epoch Macro{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Performance</h1>
        <p class="text-gray-500 dark:text-gray-400 mt-1">
            Track record and performance analytics
        </p>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5">
            <div class="text-sm text-gray-500 dark:text-gray-400">YTD Return</div>
            <div class="text-2xl font-bold text-success">+{{ performance.ytd_return }}%</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5">
            <div class="text-sm text-gray-500 dark:text-gray-400">MTD Return</div>
            <div class="text-2xl font-bold text-success">+{{ performance.mtd_return }}%</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5">
            <div class="text-sm text-gray-500 dark:text-gray-400">Total Return</div>
            <div class="text-2xl font-bold text-navy dark:text-white">+{{ performance.total_return }}%</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5">
            <div class="text-sm text-gray-500 dark:text-gray-400">Sharpe Ratio</div>
            <div class="text-2xl font-bold text-navy dark:text-white">{{ performance.sharpe }}</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5">
            <div class="text-sm text-gray-500 dark:text-gray-400">Max Drawdown</div>
            <div class="text-2xl font-bold text-warning">{{ performance.max_drawdown }}%</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5">
            <div class="text-sm text-gray-500 dark:text-gray-400">Win Rate</div>
            <div class="text-2xl font-bold text-navy dark:text-white">{{ performance.win_rate }}%</div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5">
            <div class="text-sm text-gray-500 dark:text-gray-400">Avg Trade</div>
            <div class="text-2xl font-bold text-navy dark:text-white">+{{ performance.avg_trade }}%</div>
        </div>
    </div>

    <!-- Equity Curve Chart -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Equity Curve</h2>
            <div class="flex gap-2">
                <button class="px-3 py-1 text-sm rounded bg-navy text-white">All</button>
                <button class="px-3 py-1 text-sm rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300">1Y</button>
                <button class="px-3 py-1 text-sm rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300">6M</button>
                <button class="px-3 py-1 text-sm rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300">3M</button>
            </div>
        </div>
        <div class="h-80">
            <canvas id="equityChart"></canvas>
        </div>
    </div>

    <!-- Monthly Returns -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Monthly Returns</h2>

        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">
                        <th class="pb-3">Month</th>
                        <th class="pb-3">Return</th>
                        <th class="pb-3">Cumulative</th>
                        <th class="pb-3 hidden sm:table-cell">Regime</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                    {% set cumulative = 0 %}
                    {% for month in monthly_returns %}
                    {% set cumulative = cumulative + month.return %}
                    <tr class="data-row">
                        <td class="py-3 font-medium text-gray-900 dark:text-white">{{ month.month }}</td>
                        <td class="py-3">
                            <span class="{% if month.return >= 0 %}text-success{% else %}text-warning{% endif %} font-medium">
                                {% if month.return >= 0 %}+{% endif %}{{ month.return }}%
                            </span>
                        </td>
                        <td class="py-3 text-gray-600 dark:text-gray-300">
                            {% if cumulative >= 0 %}+{% endif %}{{ "%.1f"|format(cumulative) }}%
                        </td>
                        <td class="py-3 hidden sm:table-cell">
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-navy/10 text-navy dark:bg-gold/10 dark:text-gold">
                                Q1 + Q3
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Performance by Regime -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Performance by Regime</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="p-4 bg-success/10 rounded-lg">
                <div class="text-sm text-gray-500 dark:text-gray-400">Q1 - Goldilocks</div>
                <div class="text-2xl font-bold text-success mt-1">+28.4%</div>
                <div class="text-xs text-gray-500 mt-1">145 days active</div>
            </div>
            <div class="p-4 bg-gold/10 rounded-lg">
                <div class="text-sm text-gray-500 dark:text-gray-400">Q2 - Reflation</div>
                <div class="text-2xl font-bold text-gold-dark mt-1">+12.1%</div>
                <div class="text-xs text-gray-500 mt-1">89 days active</div>
            </div>
            <div class="p-4 bg-warning/10 rounded-lg">
                <div class="text-sm text-gray-500 dark:text-gray-400">Q3 - Stagflation</div>
                <div class="text-2xl font-bold text-warning mt-1">+8.7%</div>
                <div class="text-xs text-gray-500 mt-1">72 days active</div>
            </div>
            <div class="p-4 bg-navy/10 rounded-lg">
                <div class="text-sm text-gray-500 dark:text-gray-400">Q4 - Deflation</div>
                <div class="text-2xl font-bold text-navy mt-1">-3.4%</div>
                <div class="text-xs text-gray-500 mt-1">48 days active</div>
            </div>
        </div>
    </div>

    <!-- Drawdown Chart -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Drawdown Analysis</h2>
        <div class="h-48">
            <canvas id="drawdownChart"></canvas>
        </div>
    </div>

    <!-- Risk Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Risk Metrics</h3>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Volatility (Ann.)</span>
                    <span class="font-medium text-gray-900 dark:text-white">18.2%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Beta (vs SPY)</span>
                    <span class="font-medium text-gray-900 dark:text-white">0.72</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Sortino Ratio</span>
                    <span class="font-medium text-gray-900 dark:text-white">1.89</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Calmar Ratio</span>
                    <span class="font-medium text-gray-900 dark:text-white">2.14</span>
                </div>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Trade Statistics</h3>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Total Trades</span>
                    <span class="font-medium text-gray-900 dark:text-white">147</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Avg Holding Period</span>
                    <span class="font-medium text-gray-900 dark:text-white">12.4 days</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Best Trade</span>
                    <span class="font-medium text-success">+14.2%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Worst Trade</span>
                    <span class="font-medium text-warning">-8.7%</span>
                </div>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-4">vs Benchmark</h3>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">SPY Return</span>
                    <span class="font-medium text-gray-900 dark:text-white">+32.1%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Alpha</span>
                    <span class="font-medium text-success">+13.7%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Information Ratio</span>
                    <span class="font-medium text-gray-900 dark:text-white">0.94</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Correlation</span>
                    <span class="font-medium text-gray-900 dark:text-white">0.68</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Equity Curve Chart
    const equityCtx = document.getElementById('equityChart').getContext('2d');

    // Generate mock equity curve data
    const months = ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'];
    const equityData = [100, 103.4, 106.2, 104.7, 108.9, 113.1, 116.3];
    const spyData = [100, 102.1, 104.5, 103.2, 107.8, 111.2, 114.5];

    new Chart(equityCtx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Epoch Macro',
                data: equityData,
                borderColor: '#0F4C75',
                backgroundColor: 'rgba(15, 76, 117, 0.1)',
                fill: true,
                tension: 0.4,
                borderWidth: 2,
            }, {
                label: 'SPY',
                data: spyData,
                borderColor: '#9CA3AF',
                borderDash: [5, 5],
                fill: false,
                tension: 0.4,
                borderWidth: 2,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });

    // Drawdown Chart
    const ddCtx = document.getElementById('drawdownChart').getContext('2d');
    const ddData = [0, -1.2, -2.8, -4.5, -3.1, -1.8, -0.5, -2.2, -5.1, -3.8, -1.5, 0];

    new Chart(ddCtx, {
        type: 'line',
        data: {
            labels: ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
            datasets: [{
                label: 'Drawdown %',
                data: ddData,
                borderColor: '#B91C1C',
                backgroundColor: 'rgba(185, 28, 28, 0.2)',
                fill: true,
                tension: 0.4,
                borderWidth: 2,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    max: 0,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
</script>
{% endblock %}
